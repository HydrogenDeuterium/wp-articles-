# 解决 flask 只有在本机才能通过 ip 才能访问

## 问题

最近用 flask 写后端，遇到了一个神奇的问题。

服务器架设在局域网里，flask 服务在开发机（我的笔记本）上是可以正常在局域网内部访问的，但是在服务上部署的时候却不行。

通过 '192.168.xxx.xxx:5000' 是可以访问到服务的，但是设置在路由器上的 dns 却不能解析。

这里先说一下，服务器是 winserver 2019。

## 解决

首先考虑的是不是没有指定 flask-host ，但是本机是可以访问的，应该不是这个问题。

后来又考虑是不是环境变量问题，甚至考虑过是不是 'python app.py' 和 'python -m app' 之间的差异，种种都没有能够成功解决问题。

后来在网上搜发现有些把服务器放在云服务器上的，会有防火墙问题出现，就考虑是不是 winserver 的防火墙问题。

打开 `WF.msc`，发现 winserver 对于入站是黑名单，出战是白名单设置。

于是在入站里新加一条规则，类型选端口，放行 TCP 协议对于 5000 端口的流量，成功。

## 总结

之前没有太多的接触服务器防火墙的事情，于是这一次吃到了教训。

其实以前就吃过一次这个防火墙的亏，在搭 mc 服务器的时候，就出现过内网不能访问的情况；

但是当时因为用 frp 做了内网穿透，而 frp  的流量没有被拦截，所以用转发服务器能够正常访问，就没有想那么多，这一次也算是吃一堑长一智了。

## 后记

说起来也挺巧的，昨天才解决，隔壁群就遇到一个一样问题的。他这么宣称：

> “我的ip是xxxxx，yyyyy端口已开放，欢迎来攻，有谁攻进来了务必告诉我，因为我自己试了好几天都没法从外部连上我自己的数据库 = =”

最后发现是一样的问题（我知道他用的是云服务器上的winserver），最后完美解决
